# HDMI Matrix Proxy - Bubble Card Dashboard
# Requires: Bubble Card integration (HACS)
#
# All names come from the API dynamically!
# - Input names populate dropdown options (via automation on startup)
# - Output names displayed via Bubble Card's JavaScript templates

# ============================================================================
# MAIN DASHBOARD - Full Layout
# Paste this into a Manual Card in your Lovelace dashboard
# ============================================================================

type: vertical-stack
cards:
  # Header with Status
  - type: custom:bubble-card
    card_type: separator
    name: HDMI Matrix Control
    icon: mdi:video-switch
    sub_button:
      - entity: sensor.hdmi_matrix_health
        show_state: true
        show_background: true

  # Connection Status Cards
  - type: horizontal-stack
    cards:
      - type: custom:bubble-card
        card_type: button
        entity: sensor.hdmi_matrix_status
        name: Connection
        icon: mdi:lan-connect
        show_state: true
        button_type: state
        styles: |
          .bubble-icon-container {
            background: ${state === 'connected' ? 'rgba(76, 175, 80, 0.2)' : 'rgba(244, 67, 54, 0.2)'} !important;
          }
          .bubble-icon {
            color: ${state === 'connected' ? 'rgb(76, 175, 80)' : 'rgb(244, 67, 54)'} !important;
          }

      - type: custom:bubble-card
        card_type: button
        entity: sensor.hdmi_matrix_health
        name: Health
        icon: mdi:heart-pulse
        show_state: true
        button_type: state
        styles: |
          .bubble-icon-container {
            background: ${state === 'healthy' ? 'rgba(76, 175, 80, 0.2)' : 'rgba(244, 67, 54, 0.2)'} !important;
          }
          .bubble-icon {
            color: ${state === 'healthy' ? 'rgb(76, 175, 80)' : 'rgb(244, 67, 54)'} !important;
          }

  # Quick Presets
  - type: custom:bubble-card
    card_type: separator
    name: Quick Presets
    icon: mdi:lightning-bolt

  - type: horizontal-stack
    cards:
      - type: custom:bubble-card
        card_type: button
        entity: script.matrix_default_routing
        name: Default
        icon: mdi:restore
        button_type: call-service
        tap_action:
          action: call-service
          service: script.turn_on
          service_data:
            entity_id: script.matrix_default_routing
        styles: |
          .bubble-button-card-container {
            background: rgba(33, 150, 243, 0.1) !important;
          }
          .bubble-icon {
            color: rgb(33, 150, 243) !important;
          }

      - type: custom:bubble-card
        card_type: button
        entity: script.matrix_gaming_preset
        name: Gaming
        icon: mdi:gamepad-variant
        button_type: call-service
        tap_action:
          action: call-service
          service: script.turn_on
          service_data:
            entity_id: script.matrix_gaming_preset
        styles: |
          .bubble-button-card-container {
            background: rgba(156, 39, 176, 0.1) !important;
          }
          .bubble-icon {
            color: rgb(156, 39, 176) !important;
          }

      - type: custom:bubble-card
        card_type: button
        entity: script.matrix_movie_preset
        name: Movie
        icon: mdi:movie-open
        button_type: call-service
        tap_action:
          action: call-service
          service: script.turn_on
          service_data:
            entity_id: script.matrix_movie_preset
        styles: |
          .bubble-button-card-container {
            background: rgba(255, 152, 0, 0.1) !important;
          }
          .bubble-icon {
            color: rgb(255, 152, 0) !important;
          }

      - type: custom:bubble-card
        card_type: button
        entity: script.matrix_sports_preset
        name: Sports
        icon: mdi:basketball
        button_type: call-service
        tap_action:
          action: call-service
          service: script.turn_on
          service_data:
            entity_id: script.matrix_sports_preset
        styles: |
          .bubble-button-card-container {
            background: rgba(76, 175, 80, 0.1) !important;
          }
          .bubble-icon {
            color: rgb(76, 175, 80) !important;
          }

  # Output Routing Controls
  - type: custom:bubble-card
    card_type: separator
    name: Output Routing
    icon: mdi:television

  # Output 1
  - type: custom:bubble-card
    card_type: select
    entity: input_select.matrix_output_1_source
    icon: mdi:television
    show_state: true
    styles: |
      .bubble-select-card-container {
        background: rgba(var(--rgb-primary-color), 0.05) !important;
      }
      ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_1_current_source']?.attributes?.output_name || 'Output 1'}

  # Output 2
  - type: custom:bubble-card
    card_type: select
    entity: input_select.matrix_output_2_source
    icon: mdi:television
    show_state: true
    styles: |
      .bubble-select-card-container {
        background: rgba(var(--rgb-primary-color), 0.05) !important;
      }
      ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_2_current_source']?.attributes?.output_name || 'Output 2'}

  # Output 3
  - type: custom:bubble-card
    card_type: select
    entity: input_select.matrix_output_3_source
    icon: mdi:monitor
    show_state: true
    styles: |
      .bubble-select-card-container {
        background: rgba(var(--rgb-primary-color), 0.05) !important;
      }
      ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_3_current_source']?.attributes?.output_name || 'Output 3'}

  # Output 4
  - type: custom:bubble-card
    card_type: select
    entity: input_select.matrix_output_4_source
    icon: mdi:television
    show_state: true
    styles: |
      .bubble-select-card-container {
        background: rgba(var(--rgb-primary-color), 0.05) !important;
      }
      ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_4_current_source']?.attributes?.output_name || 'Output 4'}

  # Output 5
  - type: custom:bubble-card
    card_type: select
    entity: input_select.matrix_output_5_source
    icon: mdi:television
    show_state: true
    styles: |
      .bubble-select-card-container {
        background: rgba(var(--rgb-primary-color), 0.05) !important;
      }
      ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_5_current_source']?.attributes?.output_name || 'Output 5'}

  # Output 6
  - type: custom:bubble-card
    card_type: select
    entity: input_select.matrix_output_6_source
    icon: mdi:television
    show_state: true
    styles: |
      .bubble-select-card-container {
        background: rgba(var(--rgb-primary-color), 0.05) !important;
      }
      ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_6_current_source']?.attributes?.output_name || 'Output 6'}

  # Output 7
  - type: custom:bubble-card
    card_type: select
    entity: input_select.matrix_output_7_source
    icon: mdi:television
    show_state: true
    styles: |
      .bubble-select-card-container {
        background: rgba(var(--rgb-primary-color), 0.05) !important;
      }
      ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_7_current_source']?.attributes?.output_name || 'Output 7'}

  # Output 8
  - type: custom:bubble-card
    card_type: select
    entity: input_select.matrix_output_8_source
    icon: mdi:television
    show_state: true
    styles: |
      .bubble-select-card-container {
        background: rgba(var(--rgb-primary-color), 0.05) !important;
      }
      ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_8_current_source']?.attributes?.output_name || 'Output 8'}

---
# ============================================================================
# ALTERNATIVE: Compact Grid Layout
# Better for mobile or sidebar
# ============================================================================

type: vertical-stack
cards:
  - type: custom:bubble-card
    card_type: separator
    name: HDMI Matrix
    icon: mdi:video-switch
    sub_button:
      - entity: sensor.hdmi_matrix_health
        show_state: true

  # Compact 4-column Preset Buttons
  - type: grid
    columns: 4
    square: false
    cards:
      - type: custom:bubble-card
        card_type: button
        entity: script.matrix_default_routing
        name: Default
        icon: mdi:restore
        button_type: call-service
        tap_action:
          action: call-service
          service: script.turn_on
          service_data:
            entity_id: script.matrix_default_routing

      - type: custom:bubble-card
        card_type: button
        entity: script.matrix_gaming_preset
        name: Gaming
        icon: mdi:gamepad-variant
        button_type: call-service
        tap_action:
          action: call-service
          service: script.turn_on
          service_data:
            entity_id: script.matrix_gaming_preset

      - type: custom:bubble-card
        card_type: button
        entity: script.matrix_movie_preset
        name: Movie
        icon: mdi:movie-open
        button_type: call-service
        tap_action:
          action: call-service
          service: script.turn_on
          service_data:
            entity_id: script.matrix_movie_preset

      - type: custom:bubble-card
        card_type: button
        entity: script.matrix_sports_preset
        name: Sports
        icon: mdi:basketball
        button_type: call-service
        tap_action:
          action: call-service
          service: script.turn_on
          service_data:
            entity_id: script.matrix_sports_preset

  # Compact 2-Column Output Grid
  - type: grid
    columns: 2
    square: false
    cards:
      - type: custom:bubble-card
        card_type: select
        entity: input_select.matrix_output_1_source
        icon: mdi:television
        styles: |
          ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_1_current_source']?.attributes?.output_name || 'Output 1'}

      - type: custom:bubble-card
        card_type: select
        entity: input_select.matrix_output_2_source
        icon: mdi:television
        styles: |
          ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_2_current_source']?.attributes?.output_name || 'Output 2'}

      - type: custom:bubble-card
        card_type: select
        entity: input_select.matrix_output_3_source
        icon: mdi:monitor
        styles: |
          ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_3_current_source']?.attributes?.output_name || 'Output 3'}

      - type: custom:bubble-card
        card_type: select
        entity: input_select.matrix_output_4_source
        icon: mdi:television
        styles: |
          ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_4_current_source']?.attributes?.output_name || 'Output 4'}

      - type: custom:bubble-card
        card_type: select
        entity: input_select.matrix_output_5_source
        icon: mdi:television
        styles: |
          ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_5_current_source']?.attributes?.output_name || 'Output 5'}

      - type: custom:bubble-card
        card_type: select
        entity: input_select.matrix_output_6_source
        icon: mdi:television
        styles: |
          ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_6_current_source']?.attributes?.output_name || 'Output 6'}

      - type: custom:bubble-card
        card_type: select
        entity: input_select.matrix_output_7_source
        icon: mdi:television
        styles: |
          ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_7_current_source']?.attributes?.output_name || 'Output 7'}

      - type: custom:bubble-card
        card_type: select
        entity: input_select.matrix_output_8_source
        icon: mdi:television
        styles: |
          ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_8_current_source']?.attributes?.output_name || 'Output 8'}

---
# ============================================================================
# ALTERNATIVE: Pop-up Style (standalone card - add to any view)
# This format is for adding the pop-up as a single card
# ============================================================================
# NOTE: This alternative style requires a vertical-stack wrapper.
# See the COMPLETE POP-UP EXAMPLE section below for a ready-to-use version.

type: vertical-stack
cards:
  - type: custom:bubble-card
    card_type: pop-up
    hash: '#hdmi-matrix-alt'
    name: HDMI Matrix
    icon: mdi:video-switch
    entity: sensor.hdmi_matrix_status
  - type: horizontal-stack
    cards:
      - type: custom:bubble-card
        card_type: button
        entity: sensor.hdmi_matrix_status
        name: Status
        icon: mdi:lan-connect
        show_state: true
        button_type: state
      - type: custom:bubble-card
        card_type: button
        entity: sensor.hdmi_matrix_health
        name: Health
        icon: mdi:heart-pulse
        show_state: true
        button_type: state

  - type: custom:bubble-card
    card_type: separator
    name: Presets

  - type: horizontal-stack
    cards:
      - type: custom:bubble-card
        card_type: button
        entity: script.matrix_default_routing
        name: Default
        icon: mdi:restore
        button_type: name
        tap_action:
          action: call-service
          service: script.turn_on
          service_data:
            entity_id: script.matrix_default_routing
      - type: custom:bubble-card
        card_type: button
        entity: script.matrix_gaming_preset
        name: Gaming
        icon: mdi:gamepad-variant
        button_type: name
        tap_action:
          action: call-service
          service: script.turn_on
          service_data:
            entity_id: script.matrix_gaming_preset
      - type: custom:bubble-card
        card_type: button
        entity: script.matrix_movie_preset
        name: Movie
        icon: mdi:movie-open
        button_type: name
        tap_action:
          action: call-service
          service: script.turn_on
          service_data:
            entity_id: script.matrix_movie_preset
      - type: custom:bubble-card
        card_type: button
        entity: script.matrix_sports_preset
        name: Sports
        icon: mdi:basketball
        button_type: name
        tap_action:
          action: call-service
          service: script.turn_on
          service_data:
            entity_id: script.matrix_sports_preset

  - type: custom:bubble-card
    card_type: separator
    name: Outputs

  - type: custom:bubble-card
    card_type: select
    entity: input_select.matrix_output_1_source
    icon: mdi:television
    styles: |
      ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_1_current_source']?.attributes?.output_name || 'Output 1'}

  - type: custom:bubble-card
    card_type: select
    entity: input_select.matrix_output_2_source
    icon: mdi:television
    styles: |
      ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_2_current_source']?.attributes?.output_name || 'Output 2'}

  - type: custom:bubble-card
    card_type: select
    entity: input_select.matrix_output_3_source
    icon: mdi:monitor
    styles: |
      ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_3_current_source']?.attributes?.output_name || 'Output 3'}

  - type: custom:bubble-card
    card_type: select
    entity: input_select.matrix_output_4_source
    icon: mdi:television
    styles: |
      ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_4_current_source']?.attributes?.output_name || 'Output 4'}

  - type: custom:bubble-card
    card_type: select
    entity: input_select.matrix_output_5_source
    icon: mdi:television
    styles: |
      ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_5_current_source']?.attributes?.output_name || 'Output 5'}

  - type: custom:bubble-card
    card_type: select
    entity: input_select.matrix_output_6_source
    icon: mdi:television
    styles: |
      ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_6_current_source']?.attributes?.output_name || 'Output 6'}

  - type: custom:bubble-card
    card_type: select
    entity: input_select.matrix_output_7_source
    icon: mdi:television
    styles: |
      ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_7_current_source']?.attributes?.output_name || 'Output 7'}

  - type: custom:bubble-card
    card_type: select
    entity: input_select.matrix_output_8_source
    icon: mdi:television
    styles: |
      ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_8_current_source']?.attributes?.output_name || 'Output 8'}

---
# ============================================================================
# COMPLETE POP-UP EXAMPLE - Copy this entire section
# ============================================================================
#
# HOW TO USE:
# 1. Go to Settings → Dashboards → Add Dashboard (or use existing)
# 2. Open the dashboard, click the 3-dot menu → Edit Dashboard
# 3. Click the 3-dot menu again → Raw configuration editor
# 4. Replace everything with this YAML
# 5. Click Save, then X to exit edit mode
#
# The floating button appears in the bottom-right corner.
# Tap it to open the HDMI Matrix control panel.
# ============================================================================

views:
  - title: Home
    path: home
    cards:
      # =============================================
      # POP-UP - Must be FIRST card in the view
      # The pop-up must be inside a vertical-stack
      # =============================================
      - type: vertical-stack
        cards:
          - type: custom:bubble-card
            card_type: pop-up
            hash: '#hdmi-matrix'
            name: HDMI Matrix
            icon: mdi:video-switch
            entity: sensor.hdmi_matrix_status
          - type: custom:bubble-card
            card_type: separator
            name: Status

          - type: horizontal-stack
            cards:
              - type: custom:bubble-card
                card_type: button
                entity: sensor.hdmi_matrix_status
                name: Status
                icon: mdi:lan-connect
                show_state: true
                button_type: state
              - type: custom:bubble-card
                card_type: button
                entity: sensor.hdmi_matrix_health
                name: Health
                icon: mdi:heart-pulse
                show_state: true
                button_type: state

          - type: custom:bubble-card
            card_type: separator
            name: Presets

          - type: horizontal-stack
            cards:
              - type: custom:bubble-card
                card_type: button
                entity: script.matrix_default_routing
                name: Default
                icon: mdi:restore
                button_type: name
                tap_action:
                  action: call-service
                  service: script.turn_on
                  service_data:
                    entity_id: script.matrix_default_routing
              - type: custom:bubble-card
                card_type: button
                entity: script.matrix_gaming_preset
                name: Gaming
                icon: mdi:gamepad-variant
                button_type: name
                tap_action:
                  action: call-service
                  service: script.turn_on
                  service_data:
                    entity_id: script.matrix_gaming_preset
              - type: custom:bubble-card
                card_type: button
                entity: script.matrix_movie_preset
                name: Movie
                icon: mdi:movie-open
                button_type: name
                tap_action:
                  action: call-service
                  service: script.turn_on
                  service_data:
                    entity_id: script.matrix_movie_preset

          - type: custom:bubble-card
            card_type: separator
            name: Outputs

          - type: custom:bubble-card
            card_type: select
            entity: input_select.matrix_output_1_source
            icon: mdi:television
            show_state: true
            styles: |
              ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_1_current_source']?.attributes?.output_name || 'Output 1'}

          - type: custom:bubble-card
            card_type: select
            entity: input_select.matrix_output_2_source
            icon: mdi:television
            show_state: true
            styles: |
              ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_2_current_source']?.attributes?.output_name || 'Output 2'}

          - type: custom:bubble-card
            card_type: select
            entity: input_select.matrix_output_3_source
            icon: mdi:monitor
            show_state: true
            styles: |
              ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_3_current_source']?.attributes?.output_name || 'Output 3'}

          - type: custom:bubble-card
            card_type: select
            entity: input_select.matrix_output_4_source
            icon: mdi:television
            show_state: true
            styles: |
              ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_4_current_source']?.attributes?.output_name || 'Output 4'}

          - type: custom:bubble-card
            card_type: select
            entity: input_select.matrix_output_5_source
            icon: mdi:television
            show_state: true
            styles: |
              ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_5_current_source']?.attributes?.output_name || 'Output 5'}

          - type: custom:bubble-card
            card_type: select
            entity: input_select.matrix_output_6_source
            icon: mdi:television
            show_state: true
            styles: |
              ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_6_current_source']?.attributes?.output_name || 'Output 6'}

          - type: custom:bubble-card
            card_type: select
            entity: input_select.matrix_output_7_source
            icon: mdi:television
            show_state: true
            styles: |
              ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_7_current_source']?.attributes?.output_name || 'Output 7'}

          - type: custom:bubble-card
            card_type: select
            entity: input_select.matrix_output_8_source
            icon: mdi:television
            show_state: true
            styles: |
              ${card.querySelector('.bubble-name').innerText = hass.states['sensor.matrix_output_8_current_source']?.attributes?.output_name || 'Output 8'}

      # =============================================
      # FLOATING BUTTON - Opens the pop-up
      # =============================================
      - type: custom:bubble-card
        card_type: button
        entity: sensor.hdmi_matrix_status
        button_type: name
        name: ""
        icon: mdi:video-switch
        show_name: false
        show_state: false
        tap_action:
          action: navigate
          navigation_path: '#hdmi-matrix'
        button_action:
          tap_action:
            action: navigate
            navigation_path: '#hdmi-matrix'
        styles: |
          .bubble-button-card-container {
            position: fixed !important;
            bottom: 80px;
            right: 24px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            z-index: 5;
            background: var(--primary-color) !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
          }
          .bubble-icon-container {
            --mdc-icon-size: 28px;
          }
          .bubble-name, .bubble-state {
            display: none !important;
          }
