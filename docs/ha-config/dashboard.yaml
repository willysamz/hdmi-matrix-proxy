# HDMI Matrix Proxy - Lovelace Dashboard Card
# Paste this into a Manual Card in your Lovelace dashboard

type: vertical-stack
cards:
  # Status and Health
  - type: entities
    title: HDMI Matrix Status
    show_header_toggle: false
    entities:
      - entity: sensor.hdmi_matrix_status
        name: Connection Status
        icon: mdi:lan-connect
      - entity: sensor.hdmi_matrix_health
        name: Health
        icon: mdi:heart-pulse
      - type: attribute
        entity: sensor.hdmi_matrix_health
        attribute: uptime_seconds
        name: Uptime (seconds)
        icon: mdi:clock-outline

  # Routing Control (view current routing and change it)
  - type: markdown
    title: Routing Control
    content: |
      {% set outputs = state_attr('sensor.hdmi_matrix_routing', 'outputs') %}
      {% set input_names = state_attr('sensor.hdmi_matrix_routing', 'input_names') %}
      {% set output_names = state_attr('sensor.hdmi_matrix_routing', 'output_names') %}
      {% if outputs and input_names and output_names %}
      | Output | Current Input |
      |--------|---------------|
      {% for output in outputs -%}
      | **{{ output_names[output.output|string] }}** | {{ input_names[output.input|string] if output.input else 'None' }} |
      {% endfor %}
      
      **Input Reference:** {% for i in range(1, 9) %}{{ i }}: {{ input_names[i|string] }}{% if not loop.last %} â€¢ {% endif %}{% endfor %}
      
      **To change routing, select input number in dropdowns below:**
      {% else %}
      _Loading routing data from matrix..._
      {% endif %}
  
  - type: entities
    show_header_toggle: false
    entities:
      - entity: input_select.matrix_output_1_source
        icon: mdi:television
      - entity: input_select.matrix_output_2_source
        icon: mdi:television
      - entity: input_select.matrix_output_3_source
        icon: mdi:television
      - entity: input_select.matrix_output_4_source
        icon: mdi:television
      - entity: input_select.matrix_output_5_source
        icon: mdi:television
      - entity: input_select.matrix_output_6_source
        icon: mdi:television
      - entity: input_select.matrix_output_7_source
        icon: mdi:television
      - entity: input_select.matrix_output_8_source
        icon: mdi:television

  # Preset Scripts
  - type: entities
    title: Quick Presets
    show_header_toggle: false
    entities:
      - entity: script.matrix_default_routing
        name: Default 1:1 Routing
        icon: mdi:restore
        tap_action:
          action: call-service
          service: script.turn_on
          service_data:
            entity_id: script.matrix_default_routing
      - entity: script.matrix_all_to_input_1
        name: All to Input 1
        icon: mdi:numeric-1-box-multiple
        tap_action:
          action: call-service
          service: script.turn_on
          service_data:
            entity_id: script.matrix_all_to_input_1
      - entity: script.matrix_gaming_preset
        name: Gaming Preset
        icon: mdi:gamepad-variant
        tap_action:
          action: call-service
          service: script.turn_on
          service_data:
            entity_id: script.matrix_gaming_preset
      - entity: script.matrix_movie_preset
        name: Movie Preset
        icon: mdi:movie-open
        tap_action:
          action: call-service
          service: script.turn_on
          service_data:
            entity_id: script.matrix_movie_preset
      - entity: script.matrix_sports_preset
        name: Sports Preset
        icon: mdi:basketball
        tap_action:
          action: call-service
          service: script.turn_on
          service_data:
            entity_id: script.matrix_sports_preset
